### 테스트 코드
작성한 코드가 의도대로 잘 작동하고 예상치 못한 문제가 없는지 확인할 목적으로 작성하는 코드

#### given-when-then 패턴
테스트 코드를 3단계로 구분해 작성하는 방식.
1. **given** : 테스트 실행 준비
2. **when** : 테스트 진행
3. **then** : 테스트 결과 검증

### 스프링부트에서 애플리케이션을 테스트하기 위한 도구와 annotation
- **[[JUnit]]** : 자바용 단위 테스트 프레임워크
- **Spring Test & Spring boot test** : 스프링 부트 애플리케이션을 위한 통합 테스트 지원
- **[[AssertJ]]** : 검증문인 assertion을 작성하는 데 사용되는 라이브러리
- **Hamcrest** : 표현을 이해하기 쉽게 만드는 데 사용되는 Matcher 라이브러리
- **Mockito** : 테스트에 사용할 가짜 객체인 Mock객체를 쉽게 만들고, 관리하고, 검증할 수 있게 지원하는 테스트 프레임워크
- **JSONassert** : JSON용 assertion 라이브러리
- **JsonPath** : JSON 데이터에서 특정 데이터를 선택하고 검색하기 위한 라이브러리


## 4.3 테스트 코드 예시
**TestControllerTest**
```java 
package me.hyunsoyoung.springbootdeveloper;  
  
import org.junit.jupiter.api.AfterEach;  
import org.junit.jupiter.api.BeforeEach;  
import org.springframework.beans.factory.annotation.Autowired;  
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;  
import org.springframework.boot.test.context.SpringBootTest;  
import org.springframework.test.web.servlet.MockMvc;  
import org.springframework.test.web.servlet.setup.MockMvcBuilders;  
import org.springframework.web.context.WebApplicationContext;  
  
@SpringBootTest  // 테스트용 애플리케이션 컨텍스트 생성  
@AutoConfigureMockMvc  // MockMvc 생성 및 자동 구성  
class TestControllerTest {  
    @Autowired  
    protected MockMvc mockMvc;  
  
    @Autowired  
    private WebApplicationContext context;  
    @Autowired  
    private MemberRepository memberRepository;  
  
    @BeforeEach  // 테스트 실행 전 실행하는 메서드  
    public void mockMvcSetUp() {  
        this.mockMvc = MockMvcBuilders.webAppContextSetup(context).build();  
    }  // MockMvcSetUp() 메서드를 실행해 MockMvc를 설정해준다.
  
    @AfterEach  // 테스트 실행 후 실행하는 메서드  
    public void cleanUp() {  
        memberRepository.deleteAll();  
    }  // cleanUp() 메서드를 실행해 member 테이블에 있는 데이터 모두 삭제해준다.
}
```
##### @SpringBootTest
메인 애플리케이션 클래스에 추가하는 annotation인 @SpringBootApplication이 있는 클래스를 찾고, 그 클래스에 포함되어 있는 bean을 찾은 다음, 테스트용 application context라는 것을 만든다.

##### @AutoConfigureMockMvc
MockMvc를 생성하고 자동으로 구성하는 aanotaion.
MockMvc는 애플리케이션을 서버에 배포하지 않고도 테스트용 MVC 환경을 만들어 요청 및 전송, 응답 기능을 제공하는 유틸리티 클래스. 즉, 컨트롤러를 테스트할 때 사용되는 클래스


TestContoller의 로직을 테스트하는 코드를 추가함.
```java
package me.hyunsoyoung.springbootdeveloper;  
  
import org.junit.jupiter.api.AfterEach;  
import org.junit.jupiter.api.BeforeEach;  
import org.junit.jupiter.api.DisplayName;  
import org.junit.jupiter.api.Test;  
import org.springframework.beans.factory.annotation.Autowired;  
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;  
import org.springframework.boot.test.context.SpringBootTest;  
import org.springframework.http.MediaType;  
import org.springframework.test.web.servlet.MockMvc;  
import org.springframework.test.web.servlet.ResultActions;  
import org.springframework.test.web.servlet.setup.MockMvcBuilders;  
import org.springframework.web.context.WebApplicationContext;  
  
import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;  
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;  
import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;  
  
@SpringBootTest  // 테스트용 애플리케이션 컨텍스트 생성  
@AutoConfigureMockMvc  // MockMvc 생성 및 자동 구성  
class TestControllerTest {  
    @Autowired  
    protected MockMvc mockMvc;  
  
    @Autowired  
    private WebApplicationContext context;  
    @Autowired  
    private MemberRepository memberRepository;  
  
    @BeforeEach  // 테스트 실행 전 실행하는 메서드  
    public void mockMvcSetUp() {  
        this.mockMvc = MockMvcBuilders.webAppContextSetup(context).build();  
    }  // MockMvcSetUp() 메서드를 실행해 MockMvc를 설정해준다.  
  
    @AfterEach  // 테스트 실행 후 실행하는 메서드  
    public void cleanUp() {  
        memberRepository.deleteAll();  
    }  // cleanUp() 메서드를 실행해 member 테이블에 있는 데이터 모두 삭제해준다.  
  
    @DisplayName("getAllMembers: 아티클 조회에 성공한다.")  
    @Test  
    public void getAllMembers() throws Exception {  
        // given  
        final String url = "/test";  
        Member savedMember = memberRepository.save(new Member(1L, "홍길동"));  
  
        // when  
        final ResultActions result = mockMvc.perform(get(url) // 1  
                .accept(MediaType.APPLICATION_JSON)); // 2  
  
        // then        result  
                .andExpect(status().isOk())  //3  
                // 4, 응답의 0번째 값이 DB에 저장한 값과 같은지 확인  
                .andExpect(jsonPath("$[0].id").value(savedMember.getId()))  
                .andExpect(jsonPath("$[0].name").value(savedMember.getName()));  
    }  
}
```
**given(준비)** : 멤버를 저장
**when(진행)** : 멤버 리스트를 조회하는 API 출력
**then(검증)** : 응답 코드가 200OK이고, 반환받은 값 중에 0번째 요소의 id와 name이 저장된 값과 같은지 확인

1. `perform()` 메서드는 요청을 전송하는 역할을 하는 메서드
	결과로 ResultActions객체를 받으며, ResultActions객체는 반환값을 검증하고 확인하는 `andExpect()`메서드를 제공해준다.
2. `accept() `메서드는 요청을 보낼 때 무슨 타입으로 응답을 받을지 결정하는 메서드.
3. `andExpect() `메서드는 응답을 검증한다. 
4.  `jsonPath(\$[0].\${필드명})`은 JSON 응답값을 가져오는 역할을 하는 메서드.


### HTTP 주요 응답 코드

| 코드                        | 매핑 텍스트                  | 설명                                         |
| ------------------------- | ----------------------- | ------------------------------------------ |
| 200 OK                    | isOK()                  | HTTP 응답 코드가 200OK인지 검증                     |
| 201 Created               | isCreated()             | HTTP 응답 코드가 201Created인지 검증                |
| 400 Bad Request           | isBadRequest()          | HTTP 응답 코드가 400BadRequest인지 검증             |
| 403 Forbidden             | isForbidden()           | HTTP 응답 코드가 403Forbidden인지 검증              |
| 404 Not Found             | isNotFound()            | HTTP 응답 코드가 404NotFound인지 검증               |
| 400번대 응답 코드               | is4XXClientError()      | HTTP 응답 코드가 400번대 응답 코드인지 검증               |
| 500 Internal Server Error | isInternelServerError() | HTTP 응답 코드가 500 Internel Server Error인지 검증 |
| 500번대 응답 코드               | is5XXServerError()      | HTTP 응답 코드가 500번대 응답 코드인지 검증               |
